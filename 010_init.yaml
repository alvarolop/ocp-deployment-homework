---
- name: Automatize all the tasks
  hosts: localhost 
  tasks:
    - name: Create a var with the GUID value
      shell: GUID=`hostname|awk -F. '{print $2}'`
      register: guid 

    - name: Replace values of the GUID in the openshift-ansible hosts file
      replace:
        path: ./hosts-template-alvaro-v1
        regexp: '<GUID>'
        replace: '{{ guid }}' 

    - name: Install tools
      yum:
        name: "{{ packages }}"
      vars:
        packages:
        - atomic-openshift-utils
        - atomic-openshift-clients

- name: Prepare GUID environment variable across all hosts
  hosts: all
  tasks:
    - name: All GUID env variable
      shell: export GUID=`hostname | cut -d"." -f2`; echo "export GUID=$GUID" >> $HOME/.bashrc
